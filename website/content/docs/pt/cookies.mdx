---
title: Cookies
description: Trabalhe com cookies HTTP no AzuraJS
icon: Cookie
---

# Cookies üç™

AzuraJS fornece utilit√°rios para trabalhar com cookies HTTP de forma f√°cil e type-safe.

## Ler Cookies üìñ

Use `parseCookiesHeader` para parsear o cabe√ßalho Cookie:

```typescript
import { Get, Headers } from "azurajs/decorators";
import { parseCookiesHeader } from "azurajs/cookies";

@Get("/profile")
getProfile(@Headers("cookie") cookieHeader: string) {
  const cookies = parseCookiesHeader(cookieHeader);
  
  const sessionId = cookies.sessionId;
  const theme = cookies.theme;
  
  return { sessionId, theme };
}
```

## Definir Cookies ‚úçÔ∏è

Use `serializeCookie` para criar cabe√ßalhos Set-Cookie:

```typescript
import { Post, Body, Res } from "azurajs/decorators";
import { serializeCookie } from "azurajs/cookies";
import type { ResponseServer } from "azurajs";

@Post("/login")
login(@Body() credentials: any, @Res() res: ResponseServer) {
  // Autenticar usu√°rio
  const user = authenticate(credentials);
  
  // Definir cookie de sess√£o
  const cookie = serializeCookie("sessionId", user.sessionId, {
    httpOnly: true,
    secure: true,
    maxAge: 3600,  // 1 hora
    path: "/"
  });
  
  res.setHeader("Set-Cookie", cookie);
  res.json({ user });
}
```

## Op√ß√µes de Cookie ‚öôÔ∏è

```typescript
interface CookieOptions {
  domain?: string;      // Dom√≠nio do cookie
  path?: string;        // Caminho do cookie
  expires?: Date;       // Data de expira√ß√£o
  maxAge?: number;      // Tempo de vida em segundos
  httpOnly?: boolean;   // N√£o acess√≠vel via JavaScript
  secure?: boolean;     // Apenas HTTPS
  sameSite?: "Strict" | "Lax" | "None";  // Prote√ß√£o CSRF
}
```

### Exemplo com Todas as Op√ß√µes

```typescript
const cookie = serializeCookie("token", "abc123", {
  domain: ".example.com",
  path: "/",
  maxAge: 86400,  // 24 horas
  httpOnly: true,
  secure: true,
  sameSite: "Strict"
});

res.setHeader("Set-Cookie", cookie);
```

## M√∫ltiplos Cookies üç™üç™

Defina m√∫ltiplos cookies usando array:

```typescript
@Post("/login")
login(@Body() credentials: any, @Res() res: ResponseServer) {
  const user = authenticate(credentials);
  
  const cookies = [
    serializeCookie("sessionId", user.sessionId, {
      httpOnly: true,
      secure: true,
      maxAge: 3600
    }),
    serializeCookie("userId", user.id, {
      httpOnly: true,
      secure: true,
      maxAge: 3600
    }),
    serializeCookie("theme", user.theme, {
      maxAge: 31536000  // 1 ano
    })
  ];
  
  res.setHeader("Set-Cookie", cookies);
  res.json({ user });
}
```

## Deletar Cookies üóëÔ∏è

Defina maxAge para 0 ou expires no passado:

```typescript
@Post("/logout")
logout(@Res() res: ResponseServer) {
  const cookie = serializeCookie("sessionId", "", {
    maxAge: 0,
    path: "/"
  });
  
  res.setHeader("Set-Cookie", cookie);
  res.json({ message: "Logout realizado" });
}
```

## Cookies Seguros üîí

### Session Cookies

```typescript
interface Session {
  userId: string;
  createdAt: number;
  expiresAt: number;
}

@Post("/login")
login(@Body() credentials: any, @Res() res: ResponseServer) {
  const user = authenticate(credentials);
  
  const session: Session = {
    userId: user.id,
    createdAt: Date.now(),
    expiresAt: Date.now() + 3600000  // 1 hora
  };
  
  // Armazenar sess√£o no servidor
  sessions.set(user.sessionId, session);
  
  // Enviar apenas ID da sess√£o ao cliente
  const cookie = serializeCookie("sid", user.sessionId, {
    httpOnly: true,
    secure: true,
    sameSite: "Strict",
    maxAge: 3600
  });
  
  res.setHeader("Set-Cookie", cookie);
  res.json({ user: { id: user.id, name: user.name } });
}
```

### Cookies Assinados

Para cookies assinados, use uma biblioteca como `cookie-signature`:

```typescript
import { sign, unsign } from "cookie-signature";

const SECRET = "your-secret-key";

// Assinar cookie
@Post("/login")
login(@Body() credentials: any, @Res() res: ResponseServer) {
  const user = authenticate(credentials);
  
  const signedValue = sign(user.id, SECRET);
  const cookie = serializeCookie("userId", signedValue, {
    httpOnly: true,
    secure: true
  });
  
  res.setHeader("Set-Cookie", cookie);
  res.json({ user });
}

// Verificar cookie
@Get("/profile")
getProfile(@Headers("cookie") cookieHeader: string, @Res() res: ResponseServer) {
  const cookies = parseCookiesHeader(cookieHeader);
  const signedUserId = cookies.userId;
  
  if (!signedUserId) {
    return res.status(401).json({ error: "N√£o autenticado" });
  }
  
  const userId = unsign(signedUserId, SECRET);
  if (!userId) {
    return res.status(401).json({ error: "Cookie inv√°lido" });
  }
  
  const user = findUserById(userId);
  res.json({ user });
}
```

## Cookie Helper Class üõ†Ô∏è

Crie uma classe helper para gerenciar cookies:

```typescript
class CookieManager {
  constructor(private req: RequestServer, private res: ResponseServer) {}

  get(name: string): string | undefined {
    const cookieHeader = this.req.headers.cookie;
    if (!cookieHeader) return undefined;
    
    const cookies = parseCookiesHeader(cookieHeader);
    return cookies[name];
  }

  set(name: string, value: string, options?: CookieOptions): void {
    const cookie = serializeCookie(name, value, options);
    
    // Manter cookies existentes
    const existing = this.res.getHeader("Set-Cookie") || [];
    const cookies = Array.isArray(existing) ? existing : [existing];
    cookies.push(cookie);
    
    this.res.setHeader("Set-Cookie", cookies);
  }

  delete(name: string, options?: Omit<CookieOptions, "maxAge" | "expires">): void {
    this.set(name, "", { ...options, maxAge: 0 });
  }

  has(name: string): boolean {
    return this.get(name) !== undefined;
  }
}

// Usar no controller
@Post("/login")
login(
  @Body() credentials: any,
  @Req() req: RequestServer,
  @Res() res: ResponseServer
) {
  const cookies = new CookieManager(req, res);
  const user = authenticate(credentials);
  
  cookies.set("sessionId", user.sessionId, {
    httpOnly: true,
    secure: true,
    maxAge: 3600
  });
  
  res.json({ user });
}
```

## Middleware de Cookie üîå

Adicione cookies automaticamente ao objeto request:

```typescript
function cookieMiddleware(req: RequestServer, res: ResponseServer, next: () => void) {
  const cookieHeader = req.headers.cookie;
  req.cookies = cookieHeader ? parseCookiesHeader(cookieHeader) : {};
  next();
}

app.use(cookieMiddleware);

// Agora acesse cookies diretamente
@Get("/profile")
getProfile(@Req() req: RequestServer) {
  const sessionId = req.cookies.sessionId;
  return { sessionId };
}
```

## Valida√ß√£o de Cookies ‚úÖ

Valide cookies antes de us√°-los:

```typescript
import { z } from "zod";

const SessionCookieSchema = z.object({
  sessionId: z.string().uuid(),
  userId: z.string().uuid()
});

@Get("/dashboard")
getDashboard(@Headers("cookie") cookieHeader: string, @Res() res: ResponseServer) {
  const cookies = parseCookiesHeader(cookieHeader);
  
  try {
    const { sessionId, userId } = SessionCookieSchema.parse(cookies);
    
    // Verificar sess√£o
    const session = sessions.get(sessionId);
    if (!session || session.userId !== userId) {
      return res.status(401).json({ error: "Sess√£o inv√°lida" });
    }
    
    return res.json({ dashboard: "data" });
  } catch (error) {
    return res.status(401).json({ error: "Cookies inv√°lidos" });
  }
}
```

## Exemplos Pr√°ticos üé®

### Sistema de Autentica√ß√£o Completo

```typescript
import { randomUUID } from "crypto";

interface UserSession {
  userId: string;
  createdAt: number;
  lastActivity: number;
}

const sessions = new Map<string, UserSession>();

@Controller("/auth")
export class AuthController {
  @Post("/login")
  login(@Body() credentials: any, @Res() res: ResponseServer) {
    // Autenticar
    const user = authenticate(credentials.email, credentials.password);
    if (!user) {
      return res.status(401).json({ error: "Credenciais inv√°lidas" });
    }

    // Criar sess√£o
    const sessionId = randomUUID();
    sessions.set(sessionId, {
      userId: user.id,
      createdAt: Date.now(),
      lastActivity: Date.now()
    });

    // Definir cookie
    const cookie = serializeCookie("sessionId", sessionId, {
      httpOnly: true,
      secure: process.env.NODE_ENV === "production",
      sameSite: "Strict",
      maxAge: 86400  // 24 horas
    });

    res.setHeader("Set-Cookie", cookie);
    res.json({ user: { id: user.id, name: user.name, email: user.email } });
  }

  @Post("/logout")
  logout(@Headers("cookie") cookieHeader: string, @Res() res: ResponseServer) {
    const cookies = parseCookiesHeader(cookieHeader);
    const sessionId = cookies.sessionId;

    if (sessionId) {
      sessions.delete(sessionId);
    }

    const cookie = serializeCookie("sessionId", "", {
      maxAge: 0,
      path: "/"
    });

    res.setHeader("Set-Cookie", cookie);
    res.json({ message: "Logout realizado" });
  }

  @Get("/me")
  getCurrentUser(@Headers("cookie") cookieHeader: string, @Res() res: ResponseServer) {
    const cookies = parseCookiesHeader(cookieHeader);
    const sessionId = cookies.sessionId;

    if (!sessionId) {
      return res.status(401).json({ error: "N√£o autenticado" });
    }

    const session = sessions.get(sessionId);
    if (!session) {
      return res.status(401).json({ error: "Sess√£o inv√°lida" });
    }

    // Atualizar √∫ltima atividade
    session.lastActivity = Date.now();

    const user = findUserById(session.userId);
    res.json({ user });
  }
}
```

### Cookie de Prefer√™ncias

```typescript
interface UserPreferences {
  theme: "light" | "dark";
  language: "en" | "pt";
  timezone: string;
}

@Get("/preferences")
getPreferences(@Headers("cookie") cookieHeader: string) {
  const cookies = parseCookiesHeader(cookieHeader);
  
  const preferences: UserPreferences = {
    theme: (cookies.theme as any) || "light",
    language: (cookies.language as any) || "en",
    timezone: cookies.timezone || "UTC"
  };
  
  return { preferences };
}

@Post("/preferences")
setPreferences(@Body() prefs: UserPreferences, @Res() res: ResponseServer) {
  const cookies = [
    serializeCookie("theme", prefs.theme, { maxAge: 31536000 }),
    serializeCookie("language", prefs.language, { maxAge: 31536000 }),
    serializeCookie("timezone", prefs.timezone, { maxAge: 31536000 })
  ];
  
  res.setHeader("Set-Cookie", cookies);
  res.json({ message: "Prefer√™ncias salvas" });
}
```

## Melhores Pr√°ticas ‚ú®

<Callout type="tip">
  **Use httpOnly para cookies de sess√£o**: Previne acesso via JavaScript (prote√ß√£o XSS)
</Callout>

<Callout type="tip">
  **Use secure em produ√ß√£o**: Garante cookies apenas em HTTPS
</Callout>

<Callout type="tip">
  **Use sameSite="Strict"**: Prote√ß√£o contra CSRF
</Callout>

<Callout type="warn">
  **Nunca armazene dados sens√≠veis em cookies**: Use apenas IDs de sess√£o
</Callout>

<Callout type="warn">
  **Valide cookies do cliente**: Nunca confie cegamente em cookies
</Callout>

## Pr√≥ximos Passos üìñ

<Cards>
  <Card title="Middleware" href="middleware" description="Crie middleware de cookies" />
  <Card title="Error Handling" href="error-handling" description="Trate erros de autentica√ß√£o" />
  <Card title="TypeScript" href="typescript-support" description="Type-safe cookies" />
</Cards>
